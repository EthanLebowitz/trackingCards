<head>
<!-- Made by Ethan Lebowitz-->
<!-- This whole thing is pretty nasty and has to be refactored x-->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-114157785-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-114157785-1');
</script>
<title>Track Tool</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
* {box-sizing:border-box}
body {font-family: Verdana,sans-serif;margin:0}
.mySlides {display:none}

/* Slideshow container */
.slideshow-container {
  max-width: 70vw;
  position: relative;
  margin: auto;
}

/* Next & previous buttons */
.prev, .next {
  cursor: pointer;
  position: absolute;
  top: 50%;
  width: auto;
  padding: 16px;
  margin-top: -22px;
  color: white;
  font-weight: bold;
  font-size: 18px;
  transition: 0.6s ease;
  border-radius: 0 3px 3px 0;
  background-color: rgba(0,0,0,.4);
}

/* Position the "next button" to the right */
.next {
  right: 0;
  border-radius: 3px 0 0 3px;
}

.prev {
  left: 0;
  border-radius: 3px 0 0 3px;
}

/* On hover, add a black background color with a little bit see-through */
.prev:hover, .next:hover {
  background-color: rgba(0,0,0,0.8);
}

/* Caption text */
.text {
  color: #f2f2f2;
  font-size: 15px;
  padding: 8px 12px;
  position: absolute;
  bottom: 8px;
  width: 100%;
  text-align: center;
}

/* Number text (1/3 etc) */
.numbertext {
  color: #f2f2f2;
  font-size: 12px;
  padding: 8px 12px;
  position: absolute;
  top: 0;
}

/* The dots/bullets/indicators */
.dot {
  cursor: pointer;
  height: 15px;
  width: 15px;
  margin: 0 2px;
  background-color: #bbb;
  border-radius: 50%;
  display: inline-block;
  transition: background-color 0.6s ease;
}

.active, .dot:hover {
  background-color: #717171;
}

/* Fading animation */
.fade {
  -webkit-animation-name: fade;
  -webkit-animation-duration: 1.5s;
  animation-name: fade;
  animation-duration: 1.5s;
}

@-webkit-keyframes fade {
  from {opacity: .4} 
  to {opacity: 1}
}

@keyframes fade {
  from {opacity: .4} 
  to {opacity: 1}
}

/* On smaller screens, decrease text size */
@media only screen and (max-width: 300px) {
  .prev, .next,.text {font-size: 11px}
}

/* buttons for options */
.options {
  font-family: Arial;
  color: #ffffff;
  font-size: 20px;
  background: #707070;
  padding: 10px 20px 10px 20px;
  text-decoration: none;
}

.options:hover {
  background: #2b2b2b;
  text-decoration: none;
}
  
.wide {width: 100%;}
	
.subOptions {
  -webkit-border-radius: 5;
  -moz-border-radius: 5;
  border-radius: 5px;
  font-family: Arial;
  color: #ffffff;
  font-size: 20px;
  background: #17679c;
  padding: 10px 20px 10px 20px;
  text-decoration: none;
}

.subOptions:hover {
  background: #053754;
  text-decoration: none;
}
  
.slideshow-container {
   width:70vw;
   /*height:80vh;*/
}
.img {
   /*max-width:100%;*/
   max-height:92vh;
   max-width:70vw;
   transition: 0.3s;
}

.img:hover {opacity: .8;}
	
.modal {/* The Modal (background) */
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1; /* Sit on top */
    padding-top: 15px; /* Location of the box */
    left: 0;
    top: 0;
    width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow: auto; /* Enable scroll if needed */
    background-color: rgb(0,0,0); /* Fallback color */
    background-color: rgba(0,0,0,0.9); /* Black w/ opacity */
}

/* Modal Content (Image) */
.modal-content {
    margin: auto;
    display: block;
    /*width: 80%;*/	
    max-width: 80%;
}
	
/* The Close Button */
.close {
    position: absolute;
    top: 15px;
    right: 35px;
    color: #f1f1f1;
    font-size: 40px;
    font-weight: bold;
    transition: 0.3s;
}
	
.close:hover,
.close:focus {
    color: #bbb;
    text-decoration: none;
    cursor: pointer;
}

/* 100% Image Width on Smaller Screens */
@media only screen and (max-width: 700px){
    .modal-content {
        width: 100%;
    }
}
	
.filterContent, .infoContent{
    background-color: #fefefe;
    margin: 0% auto; /* 15% from the top and centered */
    padding: 20px;
    border: 1px solid #888;
    width: 70%; /* Could be more or less, depending on screen size */
	min-height: 80%;
}
	
#about{text-align:left !important; padding:5%;}	

#species{width:70%;}
	
</style>
<script
			  src="https://code.jquery.com/jquery-3.5.1.js"
			  integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
			  crossorigin="anonymous">
</script>
</head> 
<body>
	
<table align="center"><tr>
<td><div class="show" align="center">
  	<div class="slideshow-container" id="slideshowContainer">

		
	</div>
	<br>
	<div style="text-align:center" id="dots"></div>

</div></td>
<td width="30%" style="text-align:center" valign="top">
  <div id="location"></div>
  <button type="submit" onclick="nextEntry(2)" class="subOptions wide">Shuffle Entries</button>	
	<button type="submit" onclick="nextEntry(0)" class="options">Previous</button>
	<button type="submit" onclick="nextEntry(1)" class="options">Next</button>
	<br><br>
	<button type="submit" onclick="showAnswer()" class="options" id="showAnswer">Show Answer</button>
	<div id="answer"></div>	
  <br><br>
  <button type="submit" id="filterButton" class="subOptions wide">Filters (None)</button>
  <div class="modal" id="filterModal"><div class="filterContent">
	<span class="close">&times;</span>
	Hold ctrl (windows) or cmd (mac) to select more than one.
	<select id="species" size="9" multiple>
    	<option value="&taxon_id=41799">Fisher Cat</option>
    	<option value="&taxon_id=41663">Common Raccoon</option>
		<option value="&taxon_id=42223">White Tailed Deer</option>
		<option value="&taxon_id=41638">Black Bear</option>
    	<option value="&taxon_id=42051">Coyote</option>
    	<option value="&taxon_id=41976">Bobcat</option>
    	<option value="&taxon_id=43794">American Beaver</option>
    	<option value="&taxon_id=42652">Virginia Opossum</option>
		<option value="&taxon_id=41777">North American River Otter</option>
    	<option value="&taxon_id=42220">Mule Deer</option>
    	<option value="&taxon_id=42007">Mountain Lion</option>
    	<option value="&taxon_id=906">Wild Turkey</option>
    	<option value="&taxon_id=41880">Striped Skunk</option>
    	<option value="&taxon_id=42076">Gray Fox</option>
    	<option value="&taxon_id=74048">Moose</option>
    	<option value="&taxon_id=47075">Nine-banded Armadillo</option>
    	<option value="&taxon_id=74758">American Mink</option>
    	<option value="&taxon_id=42069">Red Fox</option>
    	<option value="&taxon_id=43111">Eastern Cottontail</option>
    	<option value="&taxon_id=44026">North American Porcupine</option>
    	<option value="&taxon_id=4956">Great Blue Heron</option>
    	<option value="&taxon_id=17855">Pileated Woodpecker</option>
    	<option value="&taxon_id=42134">Wild Boar</option>
    	<option value="&taxon_id=8010">Common Raven</option>
    	<option value="&taxon_id=43130">Black-tailed Jackrabbit</option>
    	<option value="&taxon_id=1986">Greater Roadrunner</option>
    	<option value="&taxon_id=46020">Fox Squirrel</option>
    	<option value="&taxon_id=8021">American Crow</option>
    	<option value="&taxon_id=18463">Yellow-bellied Sapsucker</option>
    	<option value="&taxon_id=118552">Domestic Cat</option>
    	<option value="&taxon_id=42113">Collared Peccary</option>
    	<option value="&taxon_id=41676">Ringtail</option>
    	<option value="&taxon_id=46017">Eastern Gray Squirrel</option>
		<option value="&taxon_id=42048">Gray Wolf</option>
		<option value="&taxon_id=18236">Northern Flicker</option>
		<option value="&taxon_id=41789">American Badger</option>
    </select><br><button type="submit" onclick="getFilters()" class="" id="addFiltersButton">Add Filters</button><div id="processing"></div>
	<div id="entryTotal"></div>
	<div id="filterDisplay"></div>
  </div></div>
  <button type="submit" class="subOptions wide" id="infoButton">More Info</button>
  <div class="modal" id="infoModal"><div class="infoContent">
	<span class="close">&times;</span>
  <div id="datInfo" style="float:right; background-color: lightblue; padding: 7px;">
    <div id="linkObs"></div>
    <div id="totalObs"></div>
    <div id="currentObs"></div>
	<div id="shuffled"></div>
  </div>
  <div id="about"><p>
	  <h2>About</h2>
	  This project is basically crowd sourced tracking flashcards. All entries are pulled from the iNaturalist <a href="https://www.inaturalist.org/projects/north-american-animal-tracking-database">North American Animal Tracking Database</a>.
	  All entries used are "research grade" assuring for some degree of recognizability. As of the time of this writing there are about 5900 research grade entries. Clicking Show Answer will reveal iNaturalist's identification of the tracks. I can't guarantee that 100% of these will be right.
	  <br><br>By default Next runs through the entries from newest to oldest. Some entries have more than one image associated with them. These can be navigated using the arrows. Clicking on an image will enlarge it. 
	  When the Shuffle Entries button is clicked the entries are reordered randomly. Filtering for species can be done with the Filter button. Filtered entries are automatically shuffled. I've only included filters for the most common entries.
	  <br><br>At the moment the layout of this tool is only designed for use on computers. It will work on phones, but crappily. If you need to use it on a phone turn the phone horizontal. I plan on making this nicer in the future.
	  <br><br>I've tried to make everything as intuitive as possible. Feel free to shoot me an email at ethanlebowitz@gmail.com if you have any questions, or suggestions. This tool is still in beta so if you notice a bug please email me!
	  <br><br>Also, if you like this tool be sure to check out the wonderful tracking community over at <a href="https://www.reddit.com/r/AnimalTracking">www.reddit.com/r/AnimalTracking</a>
	  <br><br>I hope you enjoy! <br><br>Ethan Lebowitz.
  </div></div></div>
  <p>
  <br>
  </p>
  Share Entry: <div id="shareLink" style="background-color: lightblue; padding: 0px;"></div>
</td>
</tr></table>


<script>
var iteration = 0;
var page = 1;
var data; //container for json
var totalEntries=0;
var shuffled = false;
var linkIndex=0;
var internalTotalEntries;
var anchored = (location.hash != "");
var IDsAt10kMarkers = []; //entry ID for the 10,000th entry, the 20,000th entry, etc.

$('#answer').hide(); //hide the answer

function showInfo(){ //function triggered when info button clicked. Slides info down
	$('#info').slideToggle(); 
}

function showAnswer(){ //function toggled by Show Answer button. Hides if shown, shows if hidden. Toggles between button text as well.
	var isVisible = document.getElementById("answer").offsetWidth > 0 || document.getElementById("answer").offsetHeight > 0;
	if(isVisible){
		$("#answer").hide();
		document.getElementById("showAnswer").innerHTML = "Show Answer";
	}
	else{
		$("#answer").show();
		document.getElementById("showAnswer").innerHTML = "Hide Answer";
	}
}
	
var baseUrl = "https://api.inaturalist.org/v1/observations?identified=true&photos=true&project_id=962&quality_grade=research&page=${page}&per_page=${perpage}&order=desc&order_by=created_at&callback=?"; //generated from https://api.inaturalist.org/v1/docs/#/ 
var entryIndexes = [];  //where secondary iteration and associated url indexes are stored
var filterURLs = [];  //where species filtered urls are stored
	
function generateURLs(){ //generate filter urls from filters
	filterURLs = []; 
	taxonIdChoices.forEach(function(taxonID){
		filterURLs.push("https://api.inaturalist.org/v1/observations?identified=true&photos=true&project_id=962&quality_grade=research&page=${page}&per_page=${perpage}&order=desc&order_by=created_at&callback=?"+taxonID);
	});
}
	
function initializePostIndexGen(filtered){ //sets up first slideshow and shuffles indexes after indexes are generated
	iteration = 0;
	var secondaryIteration = entryIndexes[iteration].split(":"); //this and the next line are explained in the nextEntry function
	linkIndex=secondaryIteration[0];
	console.log("secondaryit",secondaryIteration);
	console.log("finished gening indexes");
	document.getElementById("totalObs").innerHTML = totalEntries+" Entries Found"; //puts total entries in info
	if(filtered){
		page = parseFloat(secondaryIteration[1])+1;	
	}
	else{
		page=1;
	}
	document.getElementById("entryTotal").innerHTML = totalEntries+" Entries Found"; //puts total entries in info
	if(!anchored){sendQueries();}
}

async function getIDsAt10kMarkers(){ //can't retrieve entries over 10,000 without a filter so we deal with that by getting the ids of every 10,000th entry and using those to filter when we need something over the first 10,000th
	var numberOf10ks = Math.floor(totalEntries / 10000);
	var URL=baseUrl.replace("${page}", 1).replace("${perpage}", 1);
	data = await getData(URL, 0);
	var id = data.results[0].id;
	var lastMarker = id;
	for(var i = 0; i < numberOf10ks; i++){
		var URL="https://api.inaturalist.org/v1/observations?identified=true&photos=true&project_id=962&quality_grade=research&page=${page}&per_page=${perpage}&order=desc&order_by=created_at&id_below=${marker}&callback=?".replace("${page}", 10000).replace("${perpage}", 1).replace("${marker}", lastMarker);
		data = await getData(URL, 0);
		var id = data.results[0].id;
		IDsAt10kMarkers.push(id);
		lastMarker = id;
	}
	console.log(IDsAt10kMarkers);
}	
	
async function generateEntryIndexesList(){ //generates list of secondary iterations (indexes) using the filterURLs list
	entryIndexes=[]; //resets
	totalEntries=0;
	var URLindex = 0; //tacks onto beginning of each secondary index so that it can be associated with an ID
	if(filterURLs.length!=0){ //if there are filters
		document.getElementById("entryTotal").innerHTML = "processing..."; //indicates that it's processing
		for(a=0; a<filterURLs.length; a++){ //for each filter URL
			var dat;
			var internalTotalEntries=0;
			var URL=filterURLs[a].replace("${page}", page).replace("${perpage}", 1); 
			dat = await $.getJSON(URL, function(rData) { //gets info from server
				return rData;
			});
			console.log(filterURLs[URLindex]);
			internalTotalEntries = await dat.total_results;
			console.log("total",internalTotalEntries, typeof internalTotalEntries, dat);
			totalEntries+=internalTotalEntries; //adds number of entries in filtered URL to the other numbers of entries from the other URLs
			console.log(URLindex);
			for(i=0; i<internalTotalEntries; i++){ //adds secondary indexes equal to the ammount of primary (actual) indexes. tacks what URL it's associated with on the beginning
				indexCat = URLindex+":"+i;
				entryIndexes.push(indexCat);
			}
			URLindex++;
			if(URLindex==speciesChoices.length){ // this contains things that must be executed after entryIndexes[] is generated. It takes some time to get a response from the server so some things get executed out of turn if kept somewhere else.
				shuffle(entryIndexes); 
				initializePostIndexGen(true);
			}
		}
	}
	else{ //if there are no filters 
		var URL=baseUrl.replace("${page}", page).replace("${perpage}", function(){if(!shuffled){return 30;}else{return 1;}}); //use the baseURL which is just without any species filter
		var dat = $.getJSON(URL, function(rData) {
			var internalTotalEntries = rData.total_results;
			totalEntries+=internalTotalEntries; //get total entries
			for(i=0; i<internalTotalEntries; i++){ //do the whole indexing thing. Only 0 gets tacked onto the beginning because there's only the one link.
				entryIndexes.push(URLindex+":"+i);
			}
			
			if(totalEntries > 10000){
				console.log("10k");
				getIDsAt10kMarkers();
			}
			
			initializePostIndexGen(false);
		});
	}
}
	
generateEntryIndexesList();
	
function getData(URL, URLindex) { //retrieves data from inat
	console.log(URL);
	var dat = $.getJSON(URL, function(rData) {
		console.log(rData);
	});
	return dat;
}
	
async function sendQueries(){ //decides what link to use and then gets Data
	if(filterURLs.length==0){ //if no filters use base URL
		if(page > 10000){ //just assume shuffled I think. Otherwise that would be a lot of clicking for the user.
			var URL="https://api.inaturalist.org/v1/observations?identified=true&photos=true&project_id=962&quality_grade=research&page=${page}&per_page=${perpage}&order=desc&order_by=created_at&id_below=${marker}&callback=?".replace("${page}", page % 10000).replace("${perpage}", 1).replace("${marker}", IDsAt10kMarkers[Math.floor(page / 10000) - 1]); //-1 to convert to indexes
		}else{
			var URL=baseUrl.replace("${page}", page).replace("${perpage}", function(){if(!shuffled){return 30;}else{return 1;}});
		}
		data = await getData(URL, 0);
	}
	else{ //if there are filters use the filter URL associated with the linkIndex
		var URL=filterURLs[linkIndex].replace("${page}", page).replace("${perpage}", 1); //will always be shuffled with filters so we only get 1 per page
		data = await getData(URL, linkIndex);
	}
	
	if(iteration == 0){//if the page just loaded put up first entry
		var entry = data.results[0];//defines entry as the 0th entry on the page
		parseEntry(entry); //sets up starting slideshow
	}
	return data;
}	
	
async function anchorCheck(){//check if there's an anchor and if there is go to the entry
	var anchor = location.hash.replace('#','');
	console.log(anchor);
	if(anchor != ""){
		iteration = -1; //so when next is clicked it will go to the first entry.	
		var URL="https://api.inaturalist.org/v1/observations/"+anchor
		var prelimData = await getData(URL, 0);
		console.log("anchored",prelimData);	
		await parseEntry(prelimData.results[0]);
	}
	else{sendQueries();}
}
	
anchorCheck();
	
/*function clearAnchor(){
	window.location.hash="";
}	
	
window.onunload = function(event){
        clearAnchor();
    };*/
	
var speciesChoices=[];
var taxonIdChoices=[];	
	
function removeFilter(N){ //when a minus or clear is clicked in filter table
	if(N==-1){ //if clear clicked
		console.log("C");
		speciesChoices=[];
		taxonIdChoices=[];
		filterURLs=[];
		generateFilterTable(); //clear every list and generate table
	}
	else{ //if minus is clicked
		speciesChoices.splice(N, 1); //delete that item from each list
		taxonIdChoices.splice(N, 1);
		generateFilterTable(); //regenerate table again
	}
}	
	
function getFilters(){ //gets new filters from select element. Adds the names and taxon ids to their respective lists
	var element = document.getElementById("species"); 
	console.log(element);
	var speciesChoicesN = element.selectedOptions.length;
	for(i=0;i<speciesChoicesN;i++){if(!speciesChoices.includes(element.selectedOptions[i].text)){speciesChoices.push(element.selectedOptions[i].text)};}
	for(i=0;i<speciesChoicesN;i++){if(!taxonIdChoices.includes(element.selectedOptions[i].value)){ taxonIdChoices.push(element.selectedOptions[i].value); }}
	generateFilterTable(); //generates table
}
	
async function generateFilterTable(){ //this is where both additions and subtractions from the filters lead to so it's a bit more than just generate the html
	if(anchored){anchored=false; iteration=0;}
	if(!speciesChoices.length<1){ //if there are filters
		var HTML = "<br><table><tr><td>Active Filters</td></tr>"; //table header
		i=0
		speciesChoices.forEach(function(species){
			HTML = HTML + "<tr><td>"+species+"</td><td><button class='minus' type='submit' onclick='removeFilter("+i+")'>-</button></td></tr>" //adds each species name and a minus button associated with it.
			i++ //to keep minus buttons associated
		});
		HTML = HTML + "<tr><td><button class='minus' type='submit' onclick='removeFilter(-1)'>Clear Filters</button></td></tr>" //adds clear button
		document.getElementById("filterButton").innerHTML = "Filters ("+speciesChoices.length+" Active)"; 
	}
	else{ //if no filters
		HTML="" //filter table is blank
		var URL = baseUrl;
		shuffled = false; 
		document.getElementById("filterButton").innerHTML = "Filters (None)"; 
	}
	document.getElementById("filterDisplay").innerHTML = HTML; //inject html
	console.log(HTML);
	$("#species").val([]); //clear selections
	generateURLs(); //generates filter URLs
	i=0;
	iteration = 0 //sets iteration and page to 0
	page = 1;
	linkIndex = 0;
	generateEntryIndexesList(); //generates list of secondary indexes and associated link ids
	$('#answer').hide();
}
	
function generateHTML(images, entryID, entry, total){ //generates html for a new entry
	var answer = entry.taxon.preferred_common_name;
	document.getElementById("answer").innerHTML = answer; //puts entry.species_guess in the answer div
	var shareLink = "https://ethanlebowitz.github.io/trackingCards/#"+entry.id;
	document.getElementById("shareLink").innerHTML = shareLink; //link in div
	var location = entry.place_guess;
	document.getElementById("location").innerHTML = location; //displays location
	var link = entry.uri;
	document.getElementById("linkObs").innerHTML = "<a href='"+link+"'>Go To Observation</a>"; //puts link to observation on inat in info
	var total = entry.uri;
	document.getElementById("totalObs").innerHTML = totalEntries+" Entries"; //puts total entries in info
	var currentEntry = iteration+1;
	document.getElementById("currentObs").innerHTML = "Current Entry: "+currentEntry; //puts total entries in info
	document.getElementById("shuffled").innerHTML = "Shuffled: "+shuffled; //displays whether or not shuffled
	var HTML=""; //container for generated html
	for(i=0; i<images.length; i++){ //list of images is a list of image ids. For each id injects in links generated in block of html. objects with backup links serve to cover in case of jpg & JPG rather than jpeg. Ugly solution, I know.
		var currentImage = i+1;
		var thumbnailURL=entry.observation_photos[i].photo.url; //get extention
		var intermediateItem = thumbnailURL.split("/square.");
		var extention = intermediateItem[1].split("?")[0];
		console.log(extention);
		HTML=HTML+"<div class='mySlides fade'>\n<div class='numbertext'>" + currentImage +"/" + images.length + "</div><img src='https://static.inaturalist.org/photos/"+images[i]+"/original."+extention+"?' class='img' id='img"+i+"'></div>\n<div id='modal"+i+"' class='modal'><span class='close'>&times;</span><img class='modal-content' id='modalImg"+i+"'><div id='caption'></div></div>";
	}
	if(images.length>1){//only add next and prev if there is more than 1 image
		HTML=HTML+"\n\n<a class='prev' onclick='plusSlides(-1)'>&#10094;</a>\n<a class='next' onclick='plusSlides(1)'>&#10095;</a>\n"; //add next and prev buttons
	}
	document.getElementById("slideshowContainer").innerHTML = HTML; //inject generated html into page
	HTML=""; //reset container
	for(i=0; i<images.length; i++){//generate dots
		var it=i+1;
		HTML=HTML+"<span class='dot' onclick='currentSlide("+it+")'></span>\n"
	}
	document.getElementById("dots").innerHTML = HTML; //inject into page
	showSlides(slideIndex); //show slides
	generateModals(images.length);
}
	
function parseEntry(entry) { //gets list of photo ids from entry
	var entryID = entry.id; //gets entry ID
	window.location.hash=""; //set anchor as id
	var images = [];//list of image ids
	for(i=0; i<entry.photos.length; i++){ //compiling list
		var id = entry.photos[i].id
		images.push(id);
	}
	console.log(images);
	generateHTML(images, entryID, entry);
}
  
function shuffle(a) { //shuffles a list
    for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
    }
	console.log("shuff")
	shuffled = true;
    return a;
}
  
async function nextEntry(direction) { //triggered by buttons next entry, prev entry, and rand entry.
	if(anchored){anchored=false;}
	var secondaryIteration = 0;//entryIndexes uses iteration as index and becomes the coresponding value in array
	if(iteration<1 && !shuffled){ //if it's the first button press of the session getData()
		window.location.hash=""
		data = await sendQueries(); //await can be used in async functions to pause operations until functions promise is resolved into a value.
	}
	if(direction==1){ //next entry clicked
		if(iteration<(totalEntries-1)){ //if not the last entry
			iteration++; //iterate one forward
		}
	}
	else if(direction==0){ //prev entry clicked
		if(iteration>0){ //if not the first entry
			iteration--; //iterate one back
		}	
	}
	else{ //if shuffle clicked
		iteration = 0; 
		entryIndexes=shuffle(entryIndexes); //shuffles secondary indexes
		console.log("shuffled");
	}
	secondaryIteration = entryIndexes[iteration].split(":"); //gets secondary iteration (index) that is associated with actual iteration. If not filtered or shuffled they will be the same.
	console.log("second",secondaryIteration)
	linkIndex=secondaryIteration[0]; //first item is link index, second item is secondary iteration. Split deletes the :
	if(!shuffled){ //if not shuffled (and by extention not filtered) uses 30 entry pages
		var internalIteration = secondaryIteration[1] % 30; //used to iterate through photos in a page
		page = Math.floor((secondaryIteration[1]/30))+1; //derives page number from iteration
	}
	else{//if shuffled use 1 entry pages, because we have to switch page every iteration anyway
		var internalIteration = 0;
		page = parseFloat(secondaryIteration[1])+1; //derives page number from iteration
		data = await sendQueries(); //send query and get data
		console.log("gotten");
	}
	if(internalIteration == 0 && !shuffled){ //iterates page if iteration is devisable by 30. (30 items a page)
		page = (iteration/30)+1; 
		console.log("page",page);
		data = await sendQueries(); //send query and get data
		console.log(data.results);
	}
	if(internalIteration == 29 && !shuffled){ //used in case user is going backwards. Wouldn't be caught by prev if statement.
		page = ((iteration+1)/30); 
		console.log("page",page);
		data = await sendQueries(); 
		console.log(data.results);
	}
	$('#answer').hide(); //rehide answer in case it was showing and change button text to show answer again
	document.getElementById("showAnswer").innerHTML = "Show Answer";
	console.log("iteration",iteration);
	var entry = data.results[internalIteration];//defines entry as the xth entry on the page
	parseEntry(entry);
}
	

//////////////////////////slideshow
var slideIndex = 1;

function plusSlides(n) {
	showSlides(slideIndex += n);
}

function currentSlide(n) {
	showSlides(slideIndex = n);
}

function showSlides(n) {
	var i;
	var slides = document.getElementsByClassName("mySlides");
	var dots = document.getElementsByClassName("dot");
	if (n > slides.length) {slideIndex = 1}    
	if (n < 1) {slideIndex = slides.length}
	for (i = 0; i < slides.length; i++) {
		slides[i].style.display = "none";  
	}
	for (i = 0; i < dots.length; i++) {
		dots[i].className = dots[i].className.replace(" active", "");
	}
	slides[slideIndex-1].style.display = "block";  
	dots[slideIndex-1].className += " active";
}
	
//////////////////////////////////modals

$('#modal').hide();
	
function setupFilterModal(){
	// Get the modal
	var filterModal = document.getElementById('filterModal');

	// Get the button that opens the modal
	var filterBtn = document.getElementById("filterButton");

	// Get the <span> element that closes the modal
	var filterSpan = document.getElementsByClassName("close");
	filterSpan=filterSpan[filterSpan.length - 2];

	// When the user clicks on the button, open the modal
	filterBtn.onclick = function() {
		console.log("filt");
		filterModal.style.display = "block";
	}

	// When the user clicks on <span> (x), close the modal
	filterSpan.onclick = function() {
		filterModal.style.display = "none";
	} 
}
	
setupFilterModal();	
	
function setupInfoModal(){
	// Get the modal
	var infoModal = document.getElementById('infoModal');

	// Get the button that opens the modal
	var infoBtn = document.getElementById("infoButton");

	// Get the <span> element that closes the modal
	var infoSpan = document.getElementsByClassName("close");
	infoSpan=infoSpan[infoSpan.length - 1];

	// When the user clicks on the button, open the modal
	infoBtn.onclick = function() {
		console.log("info");
		infoModal.style.display = "block";
	}

	// When the user clicks on <span> (x), close the modal
	infoSpan.onclick = function() {
		infoModal.style.display = "none";
	} 
}
	
setupInfoModal();
	
function generateModals(imageCount){
	for(i=0;i<imageCount;i++){
		// Get the modal
		var modal = document.getElementById('modal'+i);

		// Get the image and insert it inside the modal - use its "alt" text as a caption
		var img = document.getElementById('img'+i);
		var modalImg = document.getElementById("modalImg"+i);
		img.onclick = function(){
			modal.style.display = "block";
			modalImg.src = this.src;
		}

		// Get the <span> element that closes the modal
		var span = document.getElementsByClassName("close")[i];

		// When the user clicks on <span> (x), close the modal
		span.onclick = function() {
			modal.style.display = "none";
		} 
		
		// When the user clicks anywhere outside of the modal, close it
		window.onclick = function(event) {
			if (event.target == modal) {
				modal.style.display = "none";
			}
			if (event.target == filterModal) {
				filterModal.style.display = "none";
			}
			if (event.target == infoModal) {
				infoModal.style.display = "none";
			}
		} 
		$(document).keyup(function(e) {
			 if (e.keyCode == 27) { // escape key maps to keycode `27`
					modal.style.display = "none";
					filterModal.style.display = "none";
					infoModal.style.display = "none";
				}
		});
	}
}

</script>
</body>
